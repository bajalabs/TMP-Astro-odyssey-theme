---
import { Container, TextCardSection } from '@components/odyssey-theme';
import Layout from '../../../layouts/Page.astro';
import { normalizeContentEntries } from '../../../utils/content.js';
import { paginate } from '../../../utils/paginate.js';
import IndustriesList from '../../../components/industries/IndustriesList.astro';
import Pagination from '../../../components/core/Pagination.astro';
import config from '../../../../theme.config.js';

export async function getStaticPaths() {
  const raw = await Astro.glob('../industry/*.mdx');
  const all = normalizeContentEntries(raw, { mapExtra: fm => ({ solutions: fm.solutions || [] }) });
  const pager = paginate(all, config.pagination.pageSize);
  return Array.from({ length: pager.totalPages }).map((_, i) => ({ params: { page: String(i + 1) } }));
}

const { page } = Astro.params;
const rawIndustries = await Astro.glob('../industry/*.mdx');
const industriesAll = normalizeContentEntries(rawIndustries, { mapExtra: fm => ({ solutions: fm.solutions || [] }) });
const pager = paginate(industriesAll, config.pagination.pageSize);
const pageNum = parseInt(page, 10) || 1;
const industries = pager.slice(pageNum);
const seo = { title: `Industries â€“ Page ${pageNum}`, description: 'Paginated industries listing.' };
---
<Layout {seo}>
  <Container>
    <TextCardSection>
      <h1>Industries (Page {pageNum})</h1>
      <p>We tailor our platform and services to unique industry needs. Explore sectors we support.</p>
    </TextCardSection>
    <section class="industries-listing__section">
      <h2>All Industries</h2>
      <IndustriesList industries={industries} />
      <Pagination currentPage={pageNum} totalPages={pager.totalPages} basePath="/industries" />
    </section>
  </Container>
</Layout>
